(window.siqcwJsonp=window.siqcwJsonp||[]).push([["ChatWindow~TraditionalForm","ConversationMessageWindowDialog"],{"1d09":function(e,t,i){"use strict";i("c1a6e")},"21f7":function(e,t,i){"use strict";i("4451")},"2b0b":function(e,t,i){},"2ee5":function(e,t,i){},"3a7e":function(e,t,i){},4362:function(e,t,i){"use strict";var a=(i("ac6a"),i("2f62")),s=i("ef71"),n=i("e6fd"),o=i("0970"),l=i("56e1"),r=i("8db4"),d=i("6661"),c=i("f4e5"),u={name:"InlineInput",inheritAttrs:!1,computed:{inputProps(){return this.$attrs}},components:{InputComponent:c.a},methods:{setFocus(){this.$refs.input.setFocus()}}},p=(i("667c"),i("2877")),h=Object(p.a)(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("InputComponent",e._b({ref:"input",class:{filled:e.inputProps.value},attrs:{placeHolder:""},scopedSlots:e._u([{key:"post-slot",fn:function(){return[i("div",{staticClass:"cus-pholder flexC"},[e._v(" "+e._s(e._f("i18n")(e.inputProps.value?e.inputProps.focusTitle:e.inputProps.placeHolder))+" "),i("span",{staticClass:"input-mandatory clrR mL5 hide"},[e._v("*")])])]},proxy:!0}])},"InputComponent",e.inputProps,!1))}),[],!1,null,"4343f704",null),m=h.exports,f=i("db3a"),b=i("e335"),g=i("f026"),C=i("00a1"),v={name:"DepartmentDropdown",props:{deptProps:{type:Object,required:!0}},data(){return{drpdownProps:this.deptProps,formatedDeptList:[]}},watch:{"deptProps.list":{immediate:!0,handler:"formatDepartments"}},methods:{formatDepartments(){let e=[],t=[],{drpdownProps:i}=this;i.list.forEach((i=>{(i={...i,name:Object(b.a)(i.name||i.display_name||i.dname),engaged:i.engaged||i.is_engaged}).status?e.push(i):t.push(i)})),this.formatedDeptList=this.sortByTitle(e).concat(this.sortByTitle(t))},sortByTitle:e=>e.sort(((e,t)=>{let i=e.name.toLowerCase(),a=t.name.toLowerCase();return i>a?1:a>i?-1:0}))},components:{DropDown:g.a,Icon:C.a}},y=v,F=(i("dfb0"),Object(p.a)(y,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("DropDown",e._b({attrs:{list:e.formatedDeptList},scopedSlots:e._u([{key:"title-slot",fn:function(){return[i("span",{staticClass:"input-mandatory mL5 clrR hide"},[e._v("*")])]},proxy:!0},{key:"post-slot",fn:function(t){var a=t.item;return[i("div",{staticClass:"flexC drpdwn-srch-clr ifont13"},[i("span",{staticClass:"mR10 font12"},[e._v(e._s(e.$doI18N(a.status?"siq.avail":a.engaged?"siq.engaged":"siq.offline")))]),i("Icon",{directives:[{name:"title",rawName:"v-title",value:e.$doI18N(a.status?"siq.online":a.engaged?"siq.engaged":"siq.offline"),expression:"$doI18N( item.status ? 'siq.online' : (item.engaged ? 'siq.engaged' : 'siq.offline') )"}],class:a.status?"online-circle":a.engaged?"engage-circle":"offline-circle",attrs:{"data-zsqa":"status_icon"}})],1)]}}])},"DropDown",e.drpdownProps,!1))}),[],!1,null,null,null)),_=F.exports,j={name:"Radio",props:{options:{type:Array,required:!0},onChange:{type:Function,default:()=>{}},error:{type:Object,default:()=>({})}}},O=(i("fea4"),Object(p.a)(j,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"radio flex flexW"},e._l(e.options,(function(t,a){return i("div",{key:a,staticClass:"flex mR10 posrel mB10 clr6"},[i("input",{staticClass:"posabs rad-inp opac0",attrs:{type:"radio",name:t.name,id:t.text,"data-zsqa":"radio_"+a},domProps:{checked:t.checked},on:{change:function(i){return e.onChange(t)}}}),i("em",{staticClass:"siqico-radio mR10",class:{"err-action-fld":e.error.show}}),i("label",{attrs:{for:t.text}},[e._v(e._s(t.text))])])})),0)}),[],!1,null,null,null)),w=O.exports,x={name:"CheckboxList",props:{error:{type:Object,default:()=>({})},options:{type:Array,default:()=>{}},onChange:{type:Function,default:()=>{}}},methods:{onFieldChange(e,t){this.$set(e,"checked",t);let i=this.options.reduce(((e,t)=>{let{checked:i,value:a}=t;return e+(i?a+";":"")}),"");i=i.slice(0,-1),this.onChange(i)}},components:{CheckBox:f.a}},D=x,I=Object(p.a)(D,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._l(e.options,(function(t,a){return i("check-box",{key:a,staticClass:"mR10 mB10",attrs:{text:t.text,isChecked:t.checked,hasError:e.error.show,onChange:function(i){return e.onFieldChange(t,i)}}})})),1)}),[],!1,null,null,null),S=I.exports,k=i("1549"),q={name:"CustomFieldLabel",props:{label:{type:String,default:""},isRequired:{type:Boolean,default:!1}}},$=(i("c79d"),Object(p.a)(q,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.label?i("div",{staticClass:"clr7 mB5",attrs:{"data-zsqa":"customfield_label"}},[e._v(" "+e._s(e.label)+" "),e.isRequired?i("em",{directives:[{name:"title",rawName:"v-title",value:"siq.required",expression:"'siq.required'"}],staticClass:"req clrR"},[e._v("*")]):e._e()]):e._e()}),[],!1,null,null,null)),T=$.exports,E={name:"CustomField",props:{config:{type:Object,default:()=>{}},isMandatory:{type:Boolean,default:!1}},data(){return{componentProps:this.config,currentComponent:{radio:"Radio",checkbox:"CheckBoxList",selectbox:"Dropdown",textarea:"TextArea"}[this.config.type]||"Input"}},methods:{onChange(e){e=e.value||e,this.config.onChange({name:this.config.name,value:e})}},components:{Radio:w,CheckBoxList:S,Dropdown:g.a,Input:c.a,TextArea:k.a,CustomFieldLabel:T}},P=E,L=(i("d17d"),Object(p.a)(P,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cus-cont",class:{"cus-mandatory":"selectbox"!=e.config.type}},[e.config.islabelNeeded?i("custom-field-label",{style:e.config.style,attrs:{label:e.config.msg,isRequired:!e.config.skippable}}):e._e(),i(e.currentComponent,e._b({tag:"component",attrs:{error:e.config.error,onChange:e.onChange,onSelect:e.onChange,onInputChange:e.onChange}},"component",e.componentProps,!1))],1)}),[],!1,null,"04f43222",null)),N=L.exports,B={name:"FirstName",props:{inputType:{type:String,default:""},mandatory:{type:Boolean,default:!1},needFocusAnim:{type:Boolean,default:!1},onEnter:{type:Function,default:()=>{}},onInputChange:{type:Function,default:()=>{}},placeHolder:{type:String,default:""},value:{type:String,default:""},salutation:{type:Boolean,default:!1},onSalutationUpdate:{type:Function,default:()=>{}},isInlineInput:{type:Boolean,default:!1},selectedSalutation:{type:String,default:"-"},error:{type:Object,default:{}}},data(){return{dropDownProps:{list:Object(r.N)(),needWrapperClass:!0,needSearch:!1},salutationValue:Object(r.M)(this.selectedSalutation)}},beforeMount(){this.dropDownProps.list.unshift({title:"-",id:"-"})},methods:{handleSalutationChange(e){this.onSalutationUpdate(e.id)}},components:{Input:c.a,DropDown:g.a,InlineInput:m}},V=B,A=(i("21f7"),Object(p.a)(V,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flex siqcw-first-name"},[e.salutation?i("DropDown",e._b({attrs:{defaultTitle:e.salutationValue,onSelect:e.handleSalutationChange}},"DropDown",e.dropDownProps,!1)):e._e(),i(e.isInlineInput?"InlineInput":"Input",e._b({tag:"component",class:{"input-salutation":e.salutation,"cwcf-mandatory posrel":e.mandatory}},"component",e.$props,!1))],1)}),[],!1,null,"3ba84ae1",null)),R=A.exports,M=i("2b0e"),U=i("4360");let W=(e,t)=>{var i;let a=e.meta;switch(null===(i=a.input_card)||void 0===i?void 0:i.type){case o.i.phone:case o.i.name:case o.i.email:case o.i.firstname:case o.i.lastname:return((e,t)=>{let i=e.input_card,a="inline"===t.inputType,s=!e.skippable,n=!a&&!U.a.getters["embedstore/isExceptionalTheme"],d=i.type===o.i.firstname,c=Object(r.P)().salutation,u=Object(r.cb)(c)?c:"-";return{component:d?"FirstName":a?"InlineInput":"Input",config:{placeHolder:Object(l.d)(i),maxLength:i.maxlength,mandatory:s,inputType:e.format,onInputChange:t.handleInputChange,value:"",focusTitle:Object(l.e)(i),needFocusAnim:n,salutation:i.salutation,isInlineInput:a,...d?{onSalutationUpdate:t.handleSalutationUpdate,selectedSalutation:u,isFirstNameCard:d}:{},...i.type===o.i.name?{autocomplete:"name"}:{},error:{show:!1,text:Object(l.c)(i),type:2},onEnter:(e,i)=>{i.preventDefault(),t.isValidField()&&t.$emit("enter")}},title:e.field_name}})(a,t);case o.i.campaign:return((e,t)=>{let i=e.meta,a={text:e.msg||t.$doI18N("siqcw.campaignlabel"),mandatory:!i.skippable,isChecked:!1,onChange:e=>{a.isChecked=e,t.$emit("campaignSelect",e)}};return{component:"CheckBox",isCampaignField:!0,title:i.field_name,config:a}})(e,t);case"custom_field":return((e,t)=>{let i=e.options,a=e.type;return e.islabelNeeded=!0,["radio","checkbox","selectbox"].includes(a)&&i.forEach((t=>{t.name=e.name,t.checked=!1})),"selectbox"===a&&(e.defaultTitle=e.msg,e.list=i,e.needSearch=!1,e.map={title:"text"},e.islabelNeeded=!1),["url","textarea","text","number","email","percentage","decimal"].includes(a)&&(e.placeHolder=e.msg,e.islabelNeeded=!1),"label"!==a&&(e.style=void 0),e.onChange=t.jsapiOnChange,e.error={show:!1,text:"",type:2},{component:"CustomField",config:{mandatory:!e.skippable,config:e,isjsapi:"radio"===a||"checkbox"===a,value:void 0}}})(a,t);default:return Object(l.g)(a)?((e,t)=>{let{defaultdepartment:i=""}=Object(r.P)(),a=t.departmentList,s=a.find((e=>e.dname===i));return s=Object(r.Y)()?s||a[0]:s,{component:"DepartmentDropdown",config:{deptProps:{list:a,onSelect:t.handleDeptSelect,selectedList:s?[s.id]:[],needSearch:!0,error:{},defaultTitle:M.a.prototype.$doI18N(o.k[o.i.dept]),map:{id:"id",title:"name"},mandatory:!0}},title:e.field_name}})(a,t):{}}};var z={name:"ConversationFormField",props:{field:{type:Object,required:!0},onFieldUpdate:{type:Function,default:()=>{}},onDeptUpdate:{type:Function,default:()=>{}},fieldValues:{type:Object,required:!0},inputType:{type:String,default:""},isEdit:{type:Boolean,default:!1}},data(){let{field:e}=this;return{currentComponent:"",fieldConfig:{},fieldMeta:e.meta,isDeptField:Object(l.g)(e.meta),fieldTitle:""}},inject:{isCallForm:{default:()=>!1},isCustomField:{default:()=>!1}},computed:{...Object(a.b)("embedstore",["callDepartments","chatDepartments"]),departmentList(){return this.isCallForm?this.callDepartments:this.chatDepartments},fieldKey(){return Object(l.b)(this.fieldMeta)},deptConfig(){return this.fieldConfig.deptProps},selectedDeptId(){return n.p?"":this.deptConfig.selectedList[0]},selectedDeptDetail(){return this.deptConfig.list.find((e=>e.id===this.selectedDeptId))}},methods:{setFieldValueWatcher(){var e;let{fieldKey:t}=this;t&&(null===(e=this.fieldUnWatcher)||void 0===e||e.call(this),this.fieldUnWatcher=this.$watch((()=>this.fieldValues[t]),(e=>{this.fieldConfig.value=e}),{immediate:!0}))},jsapiOnChange(e){let{name:t,value:i}=e;this.fieldConfig.value=i,this.onFieldUpdate(t,i,!0),this.handleCustomFieldError({})},handleInputChange(e){this.fieldConfig.value=e,this.removeError(),this.onFieldUpdate(this.fieldKey,e)},handleSalutationUpdate(e){this.onFieldUpdate("salutation",e)},handleDeptSelect(e){this.removeError(),this.departmentId=e.id,this.fieldConfig.deptProps.selectedList=[e.id],this.onDeptUpdate(e)},removeError(){(this.isDeptField?this.fieldConfig.deptProps:this.fieldConfig).error.show=!1},isEmptyField(){let{fieldConfig:e}=this,t=Object(r.P)(),i="text"===e.inputType?"name":e.inputType;return("name"!==i&&"last_name"!==i||!Object(r.f)(t[i])?t[i]:"")&&!e.value?(this.setErrorText("field.required"),!0):(this.setErrorText(o.j[this.fieldMeta.input_card.type]),!1)},handleCustomFieldError(e){let{show:t=!1,text:i=""}=e,a={show:t};i&&(a={...a,text:i,type:2}),this.fieldConfig.config=Object.assign({},this.fieldConfig.config,{error:a})},isValidField(){let{fieldConfig:e}=this,t=this.isCustomField(this.fieldMeta);if(Object(r.Y)())return!0;if(e.mandatory&&!e.value||this.isDeptField&&!this.departmentId)return this.showError(this.$doI18N("all.errinfo"));let i=Object(l.h)(this.fieldMeta,e.value);if(i=this.isEdit&&"campaign"!==this.fieldMeta.input_card.type&&this.isEmptyField()?{error:!0}:i,i.error){if(t&&e.mandatory)return void this.handleCustomFieldError({show:!0,text:i.message});this.showError(i.message)}return!i.error},setErrorText(e){this.fieldConfig.error.text=this.$doI18N(e)},showError(e){this.setFocus();this.isDeptField?this.fieldConfig.deptProps.error={show:!0}:(this.fieldConfig.error||{}).show=!0},setFocus(){var e,t;null===(e=(t=this.$refs.currentComp).setFocus)||void 0===e||e.call(t)},setFieldConfig(){let e=this.field,{component:t,config:i,title:a}=W(e,this);this.currentComponent=t,this.fieldConfig=i,this.fieldTitle=a,this.fieldMeta=e.meta,this.isDeptField=Object(l.g)(e.meta),this.setFieldValueWatcher(),this.setDeptWatcher()},setDeptWatcher(){this.isDeptField&&(this.selectedDeptId&&this.handleDeptSelect(this.selectedDeptDetail),this.deptWatcher=this.$watch((()=>this.departmentList),(e=>{this.fieldConfig.deptProps.list=e,this.selectedDeptId&&this.handleDeptSelect(this.selectedDeptDetail)})))}},watch:{field:{immediate:!0,deep:!0,handler(){this.setFieldConfig()}}},beforeDestroy(){var e,t;null===(e=this.fieldUnWatcher)||void 0===e||e.call(this),null===(t=this.deptWatcher)||void 0===t||t.call(this)},components:{Input:c.a,InlineInput:m,CheckBox:f.a,DepartmentDropdown:_,CustomField:N,FirstName:R}},H=z,K=(i("e082"),Object(p.a)(H,(function(){var e=this,t=e.$createElement;return(e._self._c||t)(e.currentComponent,e._b({ref:"currentComp",tag:"component",staticClass:"mB15 fshrink",class:{"cwcf-mandatory posrel":e.fieldConfig.mandatory&&!e.fieldConfig.isjsapi&&!e.fieldConfig.isFirstNameCard||e.isDeptField},attrs:{"data-zsqa":e.fieldTitle}},"component",e.fieldConfig,!1))}),[],!1,null,null,null)),G=K.exports,Y={name:"ConversationForm",mixins:[i("baec").a],props:{isEdit:{type:Boolean,default:!1},inputType:{type:String,default:""},question:String,initiateChat:{type:Function,default:()=>{}}},data(){return{fieldValues:{},fieldList:[],isFieldsLoading:!1,defaultDepartment:"",isSubscribed:void 0,customFieldValues:{},chatDetail:this.getChatDetail()}},provide(){return{isCustomField:this.isCustomField}},inject:{embedDetail:{default:()=>({})},getPrevChatDetail:{default:()=>()=>{}},patchCurrentNavigation:{default:()=>()=>{}},getChatDetail:{default:()=>()=>({})},chatConsentNeeded:{default:!1},isCallForm:{default:()=>!1}},computed:{...Object(a.c)("embedstore",["visitorInfo","tempVisitorInfo"]),...Object(a.b)({defaultChatDepartment:"embedstore/defaultChatDepartment",defaultCallDepartments:"embedstore/defaultCallDepartments",getDepartmentDetail:"embedstore/getDepartmentDetail",isTraditionalForm:"embedstore/isTraditionalForm",embedStatus:"embedstore/embedStatus",chatConfig:"embedstore/chatConfig"}),isRemoveDeptField(){return e=>Object(l.g)(e)&&(this.showLimitedFields||this.defaultDepartment)},isClearField(){return e=>{var t;let i=e.name||"siq_"+(e.field_name.toLowerCase()||(null===(t=e.input_card)||void 0===t?void 0:t.type.replace("visitor_","")));return(this.visitorInfo.clearfield||[]).includes(i)}},filteredFieldList(){let e=this.fieldList;return!Object(r.b)(this.chatDetail)||this.isEdit||Object(l.a)(this.chatDetail,e)?e.filter((e=>{let{meta:t}=e;return!(this.isRemoveDeptField(t)||this.isClearField(t))||!this.isEdit&&this.isCustomField(t)})):[]},prevChatDetail(){return this.getPrevChatDetail()},isSkippable(){return!this.filteredFieldList.some((e=>!e.meta.skippable))},showLimitedFields(){return this.isEdit||this.prevChatDetail.attenderId},currentFormFieldConfig(){return Object(r.E)(this.isCallForm)}},beforeMount(){this.init()},mounted(){o.c.forEach((e=>{this.tempVisitorInfo[e]&&(this.fieldValues[e]=this.tempVisitorInfo[e])}))},methods:{init(){this.departmentId=this.defaultDepartment=this.prevChatDetail.departmentId||(this.isCallForm?this.defaultCallDepartments:this.defaultChatDepartment)||this.getChatDetail().departmentId,this.isEdit||!this.currentFormFieldConfig?this.fetchFormFields():this.handleFormLoad(),this.setFieldWatcher()},fetchFormFields(){this.isFieldsLoading=!0,this.$store.dispatch("embedstore/getVisitorConfiguration",{question:this.question,isCall:this.isCallForm}).finally((()=>this.isFieldsLoading=!1))},setFieldWatcher(){this.fieldUnWatchers=o.c.map((e=>this.$watch((()=>this.visitorInfo[e]),(t=>{"name"!==e&&"last_name"!==e||!Object(r.f)(t)||(t=""),this.$set(this.fieldValues,e,t)}),{immediate:!0})))},checkAndStartChat(){if(this.isEdit||this.isFieldsLoading)return;let{visitorInfo:e}=this;e.chatstart||e.chatmode?(!this.isEdit&&!this.chatConsentNeeded&&this.initiateChat(),Object(d.b)()):Object(r.Y)()&&this.initiateChat()},handleFormLoad(){if(this.fieldList=(this.currentFormFieldConfig.msglist||[]).slice(),this.setCustomField(),this.isFieldsLoading=!1,this.filteredFieldList.length)return this.$emit("formLoad"),this.$nextTick(this.checkAndStartChat),this.setFieldFocus();this.$nextTick((()=>{this.emitFocus(),this.checkAndStartChat(),this.$emit(this.isEdit?"close":"submit")}))},getFieldRefs(){return this.$refs.fields||[]},setFieldFocus(){n.p||s.c||this.$nextTick((()=>{if(!this.getFieldRefs().find((e=>{if(e.fieldKey&&!e.fieldConfig.value)return e.setFocus(),!0}))){let e=this.$el.querySelector("input");e&&e.focus()}}))},getCustomFieldPosition(e){return this.filteredFieldList,e=e.toLowerCase(),this.filteredFieldList.findIndex((t=>t.meta.field_name.toLowerCase()===e))},setCustomField(){let e=this.visitorInfo.customfield||[];!this.isEdit&&e.length&&(this.isTraditionalForm||this.isCallForm)&&e.forEach((e=>{let{name:t,options:i,required:a,type:s,visibility:n,hint:o,style:l,before:r,after:d,maxlength:c,minlength:u}=e;n=n||"both";let p=this.embedStatus,h="online"===n&&!p||"offline"===n&&p,m=this.fieldList;if(h)return;u=c?0:u;let f={dname:"Agent",meta:{name:t,options:i,skippable:!("true"===a&&"label"!=s),type:s,visibility:n,style:l,before:r,after:d,input_card:{type:"custom_field"},msg:o,maxLength:c,minLength:u}};if(r||d){let e=this.getCustomFieldPosition(r||d);if(-1!==e)return void m.splice(r?e:e+1,0,f)}m.push(f)}))},isCustomField:e=>e.input_card&&e.input_card.type===o.i.customfield,emitFocus(){this.$emit("focus")},focusNextField(e){let t=this.getFieldRefs()[e+1];if(!t)return this.emitFocus();t.fieldKey?t.setFocus():this.emitFocus()},handleUpdate(e,t,i){let{fieldValues:a,customFieldValues:s}=this;if(i)return s[e]=t,void this.handleCustomFieldCallback(e,t);this.$store.commit("embedstore/updateState",{key:"tempVisitorInfo",res:t,subKey:e}),t?a[e]=t:delete a[e]},handleCustomFieldCallback(e,t){let i=parent.$zohosq.values.customfield.find((t=>t.name===e));(null==i?void 0:i.callback)&&i.callback(t)},updateDepartmentId(e){this.departmentId=e.id,this.handleDepartmentStatus(e.status,e.engaged)},getEngagedMsg(){let e=this.visitorInfo.engagedBannerText;return e||(Object(r.J)("engaged")||(this.isCallForm?Object(r.q)():this.chatConfig.agents_engaged.message||"engaged.text"))},handleDepartmentStatus(e,t){this.$emit("deptUpdate",e),Object(r.b)(this.chatDetail)||this.patchCurrentNavigation({title:Object(r.F)(this.isCallForm,e)}),!e&&this.componentStatus&&this.$showBanner(this.$doI18N(this.componentStatus?t?this.getEngagedMsg():this.getOfflineMsg():"embed.offlinemsg"))},getOfflineMsg(e){return this.visitorInfo.offlineBannerText||(e?this.chatConfig.agents_busy.message:"chat.offline.dept")},hasValidFields(){if(!this.filteredFieldList.length)return!0;let e=!0;for(let t of[...this.getFieldRefs()].reverse())t.isValidField()||(e=!1);return e},getFormResponse(e){return this.getFieldRefs().map((t=>e?{msg:this.$doI18N("chat.skip"),meta:{type:"skip",value:""}}:{msg:this.fieldValues[t.fieldKey]||t.isDeptField&&this.getDepartmentDetail(this.departmentId).name||this.isSubscribed||this.$doI18N("chat.emptyvalue")}))},getFormMessage(e){return this.getFieldRefs().reduce(((t,i)=>{var a;let s=null===(a=i.fieldMeta.input_card)||void 0===a?void 0:a.type,n=this.$doI18N(o.l[s]||i.isDeptField&&"siqcw.department");if(s===o.i.firstname){let e=i.fieldValues.salutation;e&&(t+=`*${this.$doI18N(o.l.salutation)}* \n ${Object(r.M)(e)} \n`)}if(!n)return t;return t+`*${n}* \n ${!e&&(()=>this.fieldValues[i.fieldKey]||i.isDeptField&&this.getDepartmentDetail(this.departmentId).name)()||this.$doI18N("chat.emptyvalue")} \n`}),"")}},watch:{visitorInfo(e){(e.chatstart||e.chatmode||Object(r.Y)())&&this.checkAndStartChat()},currentFormFieldConfig(e){this.$emit("deptUpdate",!0),e?this.handleFormLoad():this.fetchFormFields()}},beforeDestroy(){this.fieldUnWatchers.forEach((e=>e())),delete this.fieldUnWatchers},components:{ConversationFormField:G}},J=Y,Q=(i("1d09"),Object(p.a)(J,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"aria",rawName:"v-aria:form",arg:"form"}],staticClass:"flex fdirection"},[e.isFieldsLoading?i("div",{staticClass:"flexM h100"},[i("LoadingIcon")],1):[e._l(e.filteredFieldList,(function(t,a){return i("ConversationFormField",{key:a,ref:"fields",refInFor:!0,attrs:{field:t,onFieldUpdate:e.handleUpdate,onDeptUpdate:e.updateDepartmentId,fieldValues:e.fieldValues,inputType:e.inputType,isEdit:e.isEdit},on:{enter:function(t){return e.focusNextField(a)},campaignSelect:function(t){return e.isSubscribed=t}}})})),e._t("field",null,{isSkippable:e.isSkippable})]],2)}),[],!1,null,"6076dab6",null));t.a=Q.exports},4451:function(e,t,i){},5443:function(e,t,i){},"667c":function(e,t,i){"use strict";i("becf")},"6a73":function(e,t,i){"use strict";i("fa96")},7039:function(e,t,i){},7456:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"d",(function(){return E})),i.d(t,"c",(function(){return P})),i.d(t,"e",(function(){return L})),i.d(t,"b",(function(){return N}));var a=i("2b0e"),s=i("4360"),n=i("6661"),o=i("bec7"),l=i("b5f5"),r=i("e6fd"),d=(i("8b34"),i("24fa")),c=i("8db4"),u=i("2c40"),p=i("0970"),h=i("7f80"),m=i("bc04"),f=i("fe0d"),b=i("056b"),g=i("8048");const C=a.a.prototype;let v=(e,t)=>s.a.dispatch("conversationstore/"+e,t),y=(e,t)=>{s.a.commit("conversationstore/replaceTempChat",{clientId:e,newChatId:t})},F=e=>s.a.commit("conversationstore/setConversationDetail",e),_=e=>{C.$nextTick((()=>{C.$eventBus.$emit("handleBotTyping",{chatId:e,typing:!0}),C.$eventBus.$emit("handleBotWaitingCard",{chatId:e})}))},j=()=>{let e=Object(c.P)().address;if(!e)return"";let{latitude:t,longitude:i,city:a,state:s,country:n}=e;return{country_code:e.countrycode,zip:e.zipcode,latitude:t,longitude:i,city:a,state:s,country:n}},O=(e,t,i)=>v("getEmbedPresence").then((e=>{let a=[e.chat,e.call].map((e=>{if(e)return{status:e.online,departments:e.departments.map((e=>{let{name:t}=e;return{bot_users:e.bots&&e.bots.ids,name:t,id:e.id,engaged:e.engaged,status:e.online,is_only_bot_available:e.only_bot_available,dname:t}}))}}));s.a.commit("embedstore/updateEmbedStatusData",a),t&&(Object(c.k)(t),C.$eventBus.$emit("onlineStatusChange",i)),i&&$Support.hideCallView()})),w=(e,t)=>{Object(f.a)(e,t);let i=Object(c.u)(t),{attender:a}=e;if(i.isBroadcast=i.isBroadcast&&!!a&&!a.is_bot,a&&a.is_bot&&delete e.attender,F(e),"call"==e.type&&e.media){let t=Object.assign(e.media[0],{chatid:e.media[0].chid});"call"===e.queue_type&&(t.isCallQueued=!0,t.average_response_time=e.average_response_time),Object(c.A)().dynamicConf.useRTCPFlow?g.a.handleDirectSuccessCBK(t):SiqAVRouter.container.audioImpl.onDirectCallStarted(t)}let n=e.id;n!==t&&y(t,n);let o=Object(c.u)(n);o.isBot=i.isBot,o.status===p.f.missed&&o.inTime===o.missedTime&&(O(o.departmentId),Object(c.hb)(n));let{wms_chat_id:l}=e,r=s.a.state.conversationstore.endedChats;if(r.includes(l))return Object(c.hb)(n),o.status=p.f.closed,void r.splice(r.indexOf(l),1);let d=s.a.state.conversationstore.pickedUpChats;d[l]&&(Object(c.eb)(o.id,d[l]),Object(c.hb)(n),o.status=p.f.live,delete d[l]),i.isTrigger&&i.attenderName&&Object(c.eb)(o.id,{attenderName:i.attenderName}),_(n),Object(b.a)(o,i),o.status===p.f.queue&&(Object(c.hb)(n),Object(m.b)(n))},x=e=>{Object(c.A)().dynamicConf.useRTCPFlow?g.a.clearWaitingDirectCall():($Support.handleCallEnd("",!0),SiqAVRouter.container.audioImpl.clearOngoingCallDataOnFailure()),Object(c.k)(e)},D=e=>s.a.commit("conversationstore/appendTempChat",e),I=async e=>s.a.state.conversationstore.annonId||await v("getAnnonId",e),S=e=>i.e("chunk-2d0bd75a").then(i.bind(null,"2ba5")).then((async t=>t.default.init(await I(e),e))),k=e=>v("getTranscriptList",{chatId:e,params:{from:"bottom"},reset:!0}),q=e=>!e&&s.a.getters["embedstore/isConsentEnabled"],$=e=>(Object(c.A)().dynamicConf.isFirstNameFlowEnabled?(e.first_name||(e.last_name=Object(c.Q)(e)),e.first_name=e.first_name||"",e.last_name=e.last_name||""):e.name=Object(c.Q)(e),e),T=e=>(Object(c.A)().dynamicConf.isFirstNameFlowEnabled?delete e.name:(delete e.first_name,delete e.last_name,delete e.salutation),e),E=async(e,t,i)=>{let s=Object(c.A)().dynamicConf.isFirstNameFlowEnabled;if(l.c)return;let{visitor:u}=e,h=Object(c.e)(e);u=$(u),h&&(e.question=Object(c.s)(s?Object(c.G)(u)||u.last_name:u.name));let m=e.client_message_id=t||Object(c.w)();Object(n.g)(e.visitor);let b=!h&&q(i),g=t&&Object(c.u)(t)||{};if(!g.isProactive){let t=Object(c.P)();e.attender_email=t.agent,e.custom_wait_time=t.waitime;let i=t.requestid;i&&(e.exid=i)}if(h||b||t&&Object(c.b)(g)||Object(f.b)(m),g.isTrigger){e.autotrigger=!0;let t=Object(d.b)("triggerDetails"),i=Object(d.b)("encryptedVisitorInfo");t&&(e.trigger_data=t),Object(c.A)().dynamicConf.isTriggerWithoutTrackingEnabled&&i&&(e.encrypted_visitor_info=i,e.avuid=r.d)}let y=j();if(y&&(e.visitor.address=y),g.meta&&(e.meta=g.meta),g.isProactive&&(e.chat_id=g.chId,delete e.department_id),D({chatDetail:{...t?g:{},...e,status:p.f[b?"temp":"pending"],inTime:Date.now()},client_message_id:m}),b){let t=Object(c.u)(m);return a.a.set(t,"showTerms",!0),void(t.initiationPayload=e)}return _(m),s?await S({first_name:u.first_name,last_name:u.last_name}):await S({name:u.name}),u=T(u),v(g.isProactive?"joinProactiveChat":"startChat",e).then((e=>{w(e,m),g.isTrigger&&Object(d.d)("triggerDetails","");let t=e.id;return h||k(t).then((i=>{let{data:a}=i;if(!Object(c.u)(e.id).isBot)return;let s=a[a.length-1];if(!s.message.msglist&&s.message.text!==e.question){var n;Object(c.fb)(t,r.G.message);let e=Object(c.u)(t);e.removeBotTyping(),null===(n=e.removeBotWaitingCard)||void 0===n||n.call(e),e.typingResolver&&e.typingResolver(),delete e.waitingMsgList}})),t})).catch((t=>{let i=C.$showBanner,a=(t=t.error)&&t.code;return a===o.c?(O("",m,h).then((()=>{C.$showBanner(C.$doI18N("embed.offlinemsg")),h&&x(m)})),Promise.reject()):(a===o.b&&(Object(c.k)(e.client_message_id),i(t.message)),h&&x(m),Promise.reject())}))},P=async(e,t,i)=>{let s=t.id,n=Object(c.w)(),o=Object(c.P)(),l=o.agent,r=o.waitime;return Object(f.b)(s),h.a.appendTempMessage(s,h.a.getTempTextMessageObj(n,e,{},s)),t.status=p.f.pending,t.inTime=Date.now(),a.a.set(t,"isBot",Object(c.c)(t.departmentId)),await S(i),v("reopenChat",{chatId:t.id,data:{message:e,attender_email:l,custom_wait_time:r,client_message_id:n}}).then((e=>{w(e,s),k(e.id).then((()=>{var i;Object(c.u)(e.id).isBot&&(null===(i=t.removeBotWaitingCard)||void 0===i||i.call(t))}))}))},L=async(e,t)=>{let i=Object(c.A)().formType===p.m.chat,a={},n={};i||await s.a.dispatch("embedstore/getVisitorConfiguration",{question:e,clearContext:!0}),a=Object(c.E)()||{},n=Object(u.b)(),a.dname&&(n.name=a.dname);let o=Object(c.w)(),l={question:e,id:o,attenderName:a.dname||n.name,attenderId:n.id,[i?"convform":"inlineform"]:!0,status:p.f.temp,prevChatDetail:t,...t||{}};D({chatDetail:l,client_message_id:o}),i||Object(u.a)(o)},N=async(e,t,i)=>{let s=Object(c.A)().dynamicConf.isFirstNameFlowEnabled,{visitor:l}=e,r=e.isdirectcall,d=!r&&q(i),u=Object(c.u)(t);if(d)return a.a.set(u,"showTerms",!0),void(u.initiationPayload=e);let h=Object(c.P)().requestid;h&&(e.exid=h);let m=j();m&&(e.visitor.address=m),a.a.set(u,"isOfflineSubmit",!0),l=$(l),e.message=r?Object(c.s)(l.name):e.question,delete e.question,Object(n.g)(e.visitor);let f={};return s?(f.first_name=l.first_name,f.last_name=l.last_name):f.name=l.name,await I(f),r&&await S(f),l=T(l),v("leaveMessage",e).then((e=>{let i=e.id;if(F(e),t&&y(t,i),Object(b.b)(i),!r){let e=Object(c.u)(i);e.status=p.f.cmissed,setTimeout((()=>{e.status=p.f.missed}),3e3)}return Object(c.ib)(i),i})).catch((e=>(e.error.code===o.d?O("",t,r).then((()=>{C.$showBanner(C.$doI18N("chat.onlinebanner"))})):r&&C.$showBanner(C.$doI18N("embed.sendfail")),Promise.reject())))}},"769a":function(e,t,i){"use strict";i.r(t);var a=i("ef71"),s=i("c153"),n=i("1549"),o={name:"ConversationMessageWindowDialog",props:{iconClass:{type:String,default:""},popupClass:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},inputProps:Object,ctaButton:{type:Object,required:!0},cancelContent:{type:String,default:"siq.cancel"},onClose:{type:Function,required:!0}},mounted(){!a.c&&this.$refs.accept.$el.focus()},components:{Button:s.a,TextareaComponent:n.a}},l=(i("843b"),i("6a73"),i("2877")),r=Object(l.a)(o,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ui-transitions",{directives:[{name:"focus-out",rawName:"v-focus-out",value:e.onClose,expression:"onClose"}],attrs:{enterToClass:"siq-fadein",leaveToClass:"siq-fadeout"}},[i("div",{staticClass:"siqcw-innerpop-cont"},[i("div",{directives:[{name:"key",rawName:"v-key.escape",value:e.onClose,expression:"onClose",modifiers:{escape:!0}},{name:"click-out",rawName:"v-click-out",value:e.onClose,expression:"onClose"},{name:"aria",rawName:"v-aria:dialog",value:{label:e.title},expression:"{label: title}",arg:"dialog"}],staticClass:"siqcw-inner-popup",class:[e.popupClass,{input:e.inputProps}],attrs:{"data-zsqa":"chatbody_inner_dialog"}},[e.inputProps?i("header",{staticClass:"flexC siqcw-inner-pop-hdr",attrs:{"data-zsqa":"dialog_header_section"}},[e.iconClass?i("icon",{staticClass:"ifont15 mR10 clr7",class:e.iconClass}):e._e(),i("span",{staticClass:"clr7 flexG"},[e._v(e._s(e._f("i18n")(e.title)))])],1):e._e(),i("section",{class:[e.inputProps?"siqcw-popup-body":"mT10 textC"],attrs:{"data-zsqa":"text_section"}},[e.inputProps?[i("TextareaComponent",e._b({staticClass:"clr3-dark",class:{"msg-window-div":e.inputProps.hasEmoji},attrs:{id:"siqtextarea",showCount:!!e.inputProps.maxLength}},"TextareaComponent",e.inputProps,!1))]:[e.iconClass?i("Icon",{class:e.iconClass}):e._e(),e.title?i("div",{staticClass:"font18 mT5 clr3"},[e._v(e._s(e._f("i18n")(e.title)))]):e._e(),e.desc?i("div",{staticClass:"mT5 clr9"},[e._v(e._s(e._f("i18n")(e.desc)))]):e._e()]],2),i("footer",{staticClass:"flexM siqcw-edit-fdr"},[i("Button",{attrs:{text:e.cancelContent,className:"siqcw-btn-cancel",clickHandler:e.onClose}}),i("Button",e._b({ref:"accept",staticClass:"mL15"},"Button",e.ctaButton,!1))],1)])])])}),[],!1,null,"654c0cf9",null);t.default=r.exports},"843b":function(e,t,i){"use strict";i("7039")},"97de7":function(e,t,i){},baec:function(e,t,i){"use strict";var a=i("2f62"),s=i("8db4"),n=i("e6fd");t.a={data:()=>({departmentStatus:!0}),computed:{...Object(a.b)("embedstore",["embedStatus"]),componentStatus(){return this.isCallForm?Object(s.A)().callStatus:this.embedStatus},isWidgetOnline(){return n.p?this.embedStatus:this.componentStatus&&this.departmentStatus}},methods:{handleDepartmentUpdate(e){this.departmentStatus=e}}}},becf:function(e,t,i){},bf1d:function(e,t,i){"use strict";i("2ee5")},c153:function(e,t,i){"use strict";var a={name:"Button",props:{iconClass:{type:String,default:""},text:{type:String,default:""},clickHandler:{type:Function,default:()=>{}},className:{type:String,default:"siqcw-btn"},disabled:Boolean,loading:Boolean},computed:{btnText(){return this.$doI18N(this.text)},isWhiteBtn(){return this.className.includes("siqcw-wbtn")}}},s=(i("bf1d"),i("2877")),n=Object(s.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({directives:[{name:"aria",rawName:"v-aria:button",value:{label:e.btnText,disabled:e.disabled},expression:"{ label: btnText, disabled }",arg:"button"},{name:"a11y",rawName:"v-a11y",value:{disabled:e.disabled},expression:"{ disabled }"}],staticClass:"flexC curP posrel user-non",class:[e.className,{disabled:e.disabled||e.loading}],attrs:{siqplayground:"button","data-zsqa":e.btnText+"_btn"}},e.disabled||e.loading?{}:{click:e.clickHandler}),[e.iconClass?i("icon",{staticClass:"mR5 ifont15",class:e.iconClass}):e._e(),i("span",{directives:[{name:"title",rawName:"v-title.isElips",value:e.btnText,expression:"btnText",modifiers:{isElips:!0}}],staticClass:"elips posrel lineN",attrs:{siqplayground:"btntext"}},[e._v(e._s(e.btnText))]),e._t("post-slot"),e.loading?i("div",{staticClass:"flexM w100 h100 posabs z-index1"},[i("LoadingIcon",{attrs:{isGray:e.isWhiteBtn,className:"ifont18"}})],1):e._e()],2)}),[],!1,null,null,null);t.a=n.exports},c1a6e:function(e,t,i){},c4bd:function(e,t,i){},c70f:function(e,t,i){},c79d:function(e,t,i){"use strict";i("c70f")},ce92:function(e,t,i){"use strict";i("2b0b")},d17d:function(e,t,i){"use strict";i("3a7e")},daad:function(e,t,i){"use strict";var a=i("4360"),s=i("2f62"),n=i("e6fd"),o=i("acfe"),l=i("8db4"),r=i("5c8c"),d=i("ef71");let c={chrome:53,firefox:68,opera:40,safari:11,edge:79},u={chrome:72,firefox:66,opera:60,safari:13,edge:79};var p=i("6661"),h=i("8048"),m=i("9b31");t.a={provide(){return{startAudioCall:this.startAudioCall,checkIfHasCallIcon:()=>this.hasCallIcon}},computed:{...Object(s.c)("conversationstore",["annonId","mediaFilesLoaded","isCallDisabled"]),...Object(s.b)("conversationstore",["ongoingCallDetail"]),hasCallIcon(){let e=Object(l.A)().dynamicConf.useRTCPFlow;if(this.mediaFilesLoaded&&!this.isCallDisabled&&this.isLiveOperatorChat&&!(e=>e.isRecording||!e.attenderHasCall)(this.chatDetail)&&!this.ongoingCallDetail.chid&&(e?((e,t,i)=>{t=t.toLowerCase();let a=e?"audio"===e?c:u:c;return a[t]&&parseInt(i)>=a[t]})("audio",d.a,d.b):Object(r.a)()))return(()=>{let e=parent.window.location.protocol;return e.includes("https")||e.includes("file:")})()&&Object(o.a)()&&Object(l.A)().portalConfig.audiocall&&a.a.getters["embedstore/checkIsComponentSupported"]("call")}},methods:{startAudioCall(){if(Object(l.ab)())return this.checkConsentAndInitCall();$Support.removeCallView();let e={chatid:this.chId,wmsid:this.annonId,mediarequest:!0,mediainvitation:!0,lsuid:this.attenderId,lsid:n.e,session_id:this.$store.state.sessionId,type:"audio",mode:"visitor"};SiqAVRouter.container.audioImpl.startAudioCall(e)},startDirectAudioCall:()=>Object(l.ab)()?new Promise((e=>{h.a.handleInitDirectCall(),e()})):new Promise((e=>{Object(r.c)().then((()=>{$Support.removeCallView(),Object(p.b)(),SiqAVRouter.container.audioImpl.startApiDirectCall({conversationtype:0,successCbk:function(t){SiqAVRouter.container.uiHandler.initiateDirectCallUI(t),e()}}),SiqAVRouter.container.uiHandler.initiateDirectCallUI()}))})),startVoiceMail(e){if($Support._callPayload=e,!Object(l.ab)())return Object(r.c)().then((()=>{$Support.removeCallView(),SiqAVRouter.container.detailsHandler.populateRecorder()}));$Support.showOnGoingCall(),h.a.setVoiceMessageType("offline"),m.a.updateVoiceMessageState(!0)}}}},db3a:function(e,t,i){"use strict";var a=i("fa7d"),s={name:"CheckBox",props:{text:{type:String,default:""},onChange:{type:Function,required:!0},isChecked:{type:Boolean,default:!1},id:{type:String,default:()=>Object(a.a)()},hasError:{type:Boolean,default:!1}},methods:{handleKeyDown(e){let{keyCode:t}=e;13===t&&this.handleChange(e)},handleChange(e){e.preventDefault(),this.onChange(!this.isChecked)}}},n=s,o=(i("ce92"),i("2877")),l=Object(o.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"checkbox curP iflex flexT posrel clr8"},[i("input",{ref:"checkbox",staticClass:"curP hide_checkbox",attrs:{type:"checkbox",id:e.id,"data-zsqa":"checkbox"},domProps:{checked:e.isChecked},on:{keydown:e.handleKeyDown,change:e.handleChange}}),i("span",{staticClass:"siqico-chkbx ifont16",class:{"siqico-chkbox-checked":e.isChecked,"err-action-fld":e.hasError}}),e.text||e.$scopedSlots.default?i("label",{staticClass:"curP pL5 lineN",attrs:{for:e.id}},[e.text?i("span",[e._v(" "+e._s(e.text)+" ")]):e._t("default")],2):e._e()])}),[],!1,null,null,null);t.a=l.exports},dfb0:function(e,t,i){"use strict";i("c4bd")},e082:function(e,t,i){"use strict";i("5443")},fa96:function(e,t,i){},fea4:function(e,t,i){"use strict";i("97de7")}}]);